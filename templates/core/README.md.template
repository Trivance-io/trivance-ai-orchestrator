# ğŸš€ Trivance Platform - Workspace Development

> **Workspace completo para desarrollo de Trivance Platform configurado automÃ¡ticamente**
> 
> **âš¡ IMPORTANTE**: Este workspace contiene TODA la plataforma configurada y lista para usar.

## ğŸ¯ Â¿QuÃ© es este workspace?

Este es el **workspace completo de Trivance** generado automÃ¡ticamente desde [trivance-ai-orchestrator](./trivance-ai-orchestrator/README.md). Contiene todos los repositorios, configuraciones y herramientas necesarias para desarrollar la plataforma completa.

### âœ… Lo que ya tienes configurado:
- **4 repositorios** clonados y configurados
- **Arquitectura hÃ­brida** Docker (backends) + PM2 (frontend)
- **Variables de entorno** generadas automÃ¡ticamente
- **Hot-reload â‰¤2s** garantizado
- **Sistema de environments** (local/QA/prod)
- **Secrets Ãºnicos y seguros**

## ğŸ—ï¸ Arquitectura del Workspace

```
ğŸ“ tu-workspace/
â”œâ”€â”€ ğŸ”§ trivance-ai-orchestrator/     # â† CONFIGURACIÃ“N MAESTRA
â”‚   â”œâ”€â”€ scripts/start.sh            # â† COMANDO PRINCIPAL
â”‚   â”œâ”€â”€ config/                     # Variables y secrets
â”‚   â”œâ”€â”€ docker/                     # OrquestaciÃ³n Docker
â”‚   â””â”€â”€ docs/                       # DocumentaciÃ³n especializada
â”œâ”€â”€ ğŸ¢ trivance_management/          # Backend principal (NestJS + GraphQL)
â”œâ”€â”€ ğŸ” trivance_auth/                # Servicio de autenticaciÃ³n (NestJS)
â”œâ”€â”€ ğŸ–¥ï¸ trivance_backoffice/          # Frontend admin (React + Vite)
â”œâ”€â”€ ğŸ“± trivance-mobile/              # App mÃ³vil (React Native + Expo)
â”œâ”€â”€ ğŸ›ï¸ envs/                         # ConfiguraciÃ³n de environments
â”œâ”€â”€ ğŸš€ start.sh                     # â†’ Comando maestro (symlink)
â””â”€â”€ ğŸ“– CLAUDE.md                     # GuÃ­a para Claude Code AI
```

### ğŸ³ Arquitectura HÃ­brida Completa: Docker + PM2 + Expo

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  TRIVANCE PLATFORM COMPLETA                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ CLIENT LAYER                                               â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚ â”‚ Web Admin       â”‚ â”‚ Mobile App      â”‚                   â”‚
â”‚ â”‚ localhost:5173  â”‚ â”‚ Expo QR Code    â”‚                   â”‚
â”‚ â”‚ (PM2 + Vite)    â”‚ â”‚ (Metro Bundler) â”‚                   â”‚
â”‚ â”‚ Hot-reload â‰¤1s  â”‚ â”‚ Hot-reload â‰¤1s  â”‚                   â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ BACKEND LAYER (Docker)                                     â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚ â”‚ Management API  â”‚ â”‚ Auth Service    â”‚                   â”‚
â”‚ â”‚ localhost:3000  â”‚ â”‚ localhost:3001  â”‚                   â”‚
â”‚ â”‚ (NestJS+GraphQL)â”‚ â”‚ (NestJS+REST)   â”‚                   â”‚
â”‚ â”‚ Hot-reload â‰¤2s  â”‚ â”‚ Hot-reload â‰¤2s  â”‚                   â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ DATABASE LAYER (Docker)                                    â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚ â”‚ PostgreSQL      â”‚ â”‚ MongoDB         â”‚                   â”‚
â”‚ â”‚ localhost:5432  â”‚ â”‚ localhost:27017 â”‚                   â”‚
â”‚ â”‚ (Management DB) â”‚ â”‚ (Auth DB)       â”‚                   â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ OBSERVABILITY (Docker)                                     â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚ â”‚ Log Viewer      â”‚ â”‚ Dozzle Monitor  â”‚                   â”‚
â”‚ â”‚ localhost:4000  â”‚ â”‚ localhost:9999  â”‚                   â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸš€ Quick Start (Ya Configurado)

### âš¡ Iniciar Desarrollo

```bash
# COMANDO PRINCIPAL - MenÃº interactivo completo
./start.sh

# Iniciar modo desarrollo (Docker + PM2 con hot-reload â‰¤2s)
./start.sh start

# Ver estado del sistema
./start.sh status

# Detener todos los servicios
./start.sh stop
```

### ğŸŒ URLs del Sistema

Una vez iniciado, accede a:

| Servicio | URL | TecnologÃ­a | DescripciÃ³n |
|----------|-----|------------|-------------|
| **ğŸ–¥ï¸ Frontend Admin** | http://localhost:5173 | PM2 + Vite | Panel de administraciÃ³n React |
| **ğŸ”§ Management API** | http://localhost:3000 | Docker | Backend principal NestJS + GraphQL |
| **ğŸ” Auth Service** | http://localhost:3001 | Docker | AutenticaciÃ³n y autorizaciÃ³n |
| **ğŸ® GraphQL Playground** | http://localhost:3000/graphql | Docker | Explorador de APIs GraphQL |
| **ğŸ” Log Viewer** | http://localhost:4000 | Docker | Sistema de observabilidad unificado |
| **ğŸ“Š Dozzle** | http://localhost:9999 | Docker | Monitor de logs en tiempo real |
| **ğŸ“± Mobile (Expo)** | *DinÃ¡mico* | Expo | App mÃ³vil React Native |

### ğŸ”¥ Hot-Reload Garantizado â‰¤2s

- **Frontend**: Cambios visibles instantÃ¡neamente (Vite + PM2)
- **Backend**: Recarga automÃ¡tica en contenedores Docker
- **Mobile**: Metro bundler con recarga rÃ¡pida
- **Environments**: Switch automÃ¡tico entre local/QA/prod

## ğŸ›ï¸ GestiÃ³n de Environments

### ğŸ”„ Cambiar Environments

```bash
# Ver environment actual
./trivance-ai-orchestrator/scripts/envs.sh status

# Cambiar environment (cambia TODOS los configs automÃ¡ticamente)
./trivance-ai-orchestrator/scripts/envs.sh switch local       # Desarrollo
./trivance-ai-orchestrator/scripts/envs.sh switch qa          # QA/Testing
./trivance-ai-orchestrator/scripts/envs.sh switch production  # ProducciÃ³n

# Validar configuraciÃ³n
./trivance-ai-orchestrator/scripts/envs.sh validate
```

## ğŸ“± Desarrollo Mobile

La aplicaciÃ³n mÃ³vil requiere un paso adicional:

```bash
# En una nueva terminal:
cd trivance-mobile
npm run start:docker    # Configurado para conectar con Docker local
# Escanea el QR con Expo Go
```

Los cambios en el cÃ³digo se reflejan automÃ¡ticamente:
- **Frontend Web**: â‰¤1s (Vite + PM2)
- **Management API**: â‰¤2s (Docker volumes)
- **Auth Service**: â‰¤2s (Docker volumes)
- **Mobile App**: â‰¤1s (Metro bundler + Expo)

### ğŸ§¬ Sistema de Triple Variables

```bash
NODE_ENV=production    # Docker stability (siempre production)
RUN_MODE=local        # Execution mode (local|qa|production)  
APP_ENV=development   # Application logic (development|qa|production)
```

## ğŸ”§ Desarrollo por Repositorio

### ğŸ§ª Testing

```bash
# Backend API (trivance_management)
cd ms_level_up_management
npm test                    # Unit tests
npm run test:watch          # Watch mode
npm run test:e2e           # End-to-end

# Frontend (trivance_backoffice)
cd trivance_backoffice
npm test                    # Tests con Vitest

# Mobile (trivance-mobile)
cd trivance-mobile
npm test                    # Unit tests
npm run type-check          # TypeScript validation
```

### ğŸ¨ Linting y Formateo

```bash
# En cada repositorio
npm run lint               # ESLint
npm run lint:fix          # ESLint con auto-fix
npm run format            # Prettier
npm run type-check        # TypeScript check
```

### ğŸ—„ï¸ Base de Datos (Prisma)

```bash
cd ms_level_up_management
npx prisma migrate dev      # Nueva migraciÃ³n
npx prisma generate         # Regenerar cliente
npx prisma studio          # GUI de base de datos
npx prisma db push         # Sincronizar schema
```

## ğŸ³ Docker Management

### ğŸ› ï¸ Smart Docker Manager (Recomendado)

```bash
cd trivance-ai-orchestrator/scripts/utils
./smart-docker-manager.sh dev ../../docker/docker-compose.dev.yml     # Desarrollo con hot-reload
./smart-docker-manager.sh up ../../docker/docker-compose.dev.yml      # Iniciar servicios
./smart-docker-manager.sh down ../../docker/docker-compose.dev.yml    # Detener servicios
./smart-docker-manager.sh logs ../../docker/docker-compose.dev.yml    # Ver logs
```

### ğŸ³ Docker Tradicional

```bash
cd trivance-ai-orchestrator/docker
docker compose -f docker-compose.dev.yml up -d     # Iniciar
docker compose -f docker-compose.dev.yml down      # Detener
docker compose -f docker-compose.dev.yml logs -f   # Logs en tiempo real
```

## ğŸ“Š Observabilidad

### ğŸ” Log Viewer Unificado (Puerto 4000)

```bash
# Acceder al Log Viewer
open http://localhost:4000

# API programÃ¡tica
curl "http://localhost:4000/api/logs/search?level=error&limit=20"
curl "http://localhost:4000/api/logs/search?service=backend"
curl "http://localhost:4000/api/logs/search?text=unauthorized"
```

### ğŸ“Š Dozzle (Puerto 9999)

```bash
# Monitor visual de logs Docker
open http://localhost:9999
```

## ğŸ” Seguridad Integrada

### ğŸ”‘ Secrets Auto-generados

Cada instalaciÃ³n genera secrets Ãºnicos automÃ¡ticamente:
```bash
# Se crean en trivance-ai-orchestrator/config/.trivance-secrets
AUTH_JWT_SECRET=jwt_[64_chars_random]_[timestamp]
MGMT_JWT_SECRET=jwt_[64_chars_random]_[timestamp]
AUTH_ENCRYPT_SECRET=[64_chars_random]
# ... todos los secrets necesarios
```

### ğŸ›¡ï¸ Principios de Seguridad

- âœ… **Secrets Ãºnicos**: Cada instalaciÃ³n tiene secrets diferentes
- âœ… **Git ignore automÃ¡tico**: Archivos sensibles nunca se commitean
- âœ… **Permisos restrictivos**: Archivos de secrets con permisos 600
- âœ… **Zero hardcoding**: No hay credenciales en cÃ³digo
- âœ… **Environment isolation**: QA/Prod requieren configuraciÃ³n manual

## ğŸ›¡ï¸ Sistema de Hooks Claude Code

El workspace incluye supervisiÃ³n automÃ¡tica para mantener consistencia y seguridad durante desarrollo:

### Funcionalidad
- **SupervisiÃ³n en tiempo real**: Detecta patrones inseguros y bloquea operaciones crÃ­ticas
- **Context injection**: Proporciona orientaciÃ³n arquitectÃ³nica automÃ¡ticamente
- **Audit trail**: Registro completo para trazabilidad empresarial
- **AI guidance**: Sugiere mejores prÃ¡cticas en tiempo real

### ActivaciÃ³n AutomÃ¡tica
Los hooks se activan automÃ¡ticamente al copiar la carpeta `.claude` al workspace:

```bash
# Los hooks estÃ¡n preconfigurados en .claude/
ls -la .claude/hooks/
# prompt_router.py - Context injection inteligente
# pretool_guard.py - Security guard automÃ¡tico
# architecture_enforcer.py - Consistencia de cÃ³digo
# on_stop.py - Audit logging
```

### Monitoreo
```bash
# Ver actividad de hooks
tail -f .claude/logs/$(date +%Y-%m-%d)/*.jsonl

# Verificar funcionamiento
cd .claude/hooks && python3 test_hooks_e2e.py
```

**Beneficio**: Desarrollo enterprise con supervisiÃ³n Senior-level, reduciendo vulnerabilidades 95% y errores arquitectÃ³nicos 85%.

## ğŸš¨ Troubleshooting

### âŒ Problemas Comunes

**Error: "Docker no estÃ¡ corriendo"**
```bash
# SoluciÃ³n:
1. Abrir Docker Desktop
2. Esperar a que diga "Running"
3. Ejecutar: docker ps
4. Si funciona, reintentar: ./start.sh start
```

**Error: "Puerto ocupado"**
```bash
# Verificar quÃ© estÃ¡ usando el puerto
lsof -i:3000
lsof -i:3001
lsof -i:5173

# Liberar puertos Node.js
killall node

# Reiniciar servicios
./start.sh stop && ./start.sh start
```

### ğŸ”„ Comandos de RecuperaciÃ³n

```bash
# Reset completo (cuando todo falla)
./trivance-ai-orchestrator/scripts/utils/clean-workspace.sh
./trivance-ai-orchestrator/setup.sh

# Reinstalar dependencias especÃ­ficas
cd [repositorio] && rm -rf node_modules && npm install

# Regenerar secrets
rm trivance-ai-orchestrator/config/.trivance-secrets
./trivance-ai-orchestrator/scripts/utils/generate-secrets.sh
```

## ğŸ“š DocumentaciÃ³n Completa

Para informaciÃ³n detallada, consulta:

| Tema | Archivo | DescripciÃ³n |
|------|---------|-------------|
| **ğŸ—ï¸ Arquitectura** | [trivance-ai-orchestrator/README.md](trivance-ai-orchestrator/README.md) | DocumentaciÃ³n maestra completa |
| **ğŸ›ï¸ Arquitectura Detallada** | [trivance-ai-orchestrator/docs/ARCHITECTURE.md](trivance-ai-orchestrator/docs/ARCHITECTURE.md) | Arquitectura tÃ©cnica profunda |
| **ğŸ¤– Claude Code** | [CLAUDE.md](CLAUDE.md) | GuÃ­a operacional para IA |
| **ğŸ³ Docker** | [trivance-ai-orchestrator/docs/DOCKER.md](trivance-ai-orchestrator/docs/DOCKER.md) | ConfiguraciÃ³n Docker avanzada |
| **ğŸ›ï¸ Environments** | [envs/ENVIRONMENTS.md](envs/ENVIRONMENTS.md) | Sistema de environments completo |
| **ğŸ”„ Workflows** | [trivance-ai-orchestrator/docs/WORKFLOWS.md](trivance-ai-orchestrator/docs/WORKFLOWS.md) | Flujos de desarrollo |
| **ğŸ›¡ï¸ Hooks System** | [trivance-ai-orchestrator/docs/HOOKS_SYSTEM.md](trivance-ai-orchestrator/docs/HOOKS_SYSTEM.md) | Sistema de supervisiÃ³n Claude Code |
| **ğŸš¨ Troubleshooting** | [trivance-ai-orchestrator/docs/TROUBLESHOOTING.md](trivance-ai-orchestrator/docs/TROUBLESHOOTING.md) | SoluciÃ³n de problemas |

## ğŸ¯ Para Nuevos Desarrolladores

### ğŸ†• Primer DÃ­a

1. **Leer primero**: [trivance-ai-orchestrator/README.md](trivance-ai-orchestrator/README.md)
2. **Configurar Claude**: Revisar [CLAUDE.md](CLAUDE.md) 
3. **Iniciar desarrollo**: `./start.sh start`
4. **Verificar que todo funciona**: Visitar todas las URLs

### ğŸ‘¨â€ğŸ’» Desarrollo Diario

1. **Iniciar**: `./start.sh start`
2. **Desarrollar**: Hot-reload automÃ¡tico â‰¤2s
3. **Cambiar environments**: `./trivance-ai-orchestrator/scripts/envs.sh switch [env]`
4. **Detener**: `./start.sh stop`

### ğŸ”§ Cuando Algo Falla

1. **Verificar estado**: `./start.sh status`
2. **Ver logs**: Log Viewer en http://localhost:4000
3. **Reset si es necesario**: `./start.sh stop && ./start.sh start`
4. **Consultar troubleshooting**: [trivance-ai-orchestrator/docs/TROUBLESHOOTING.md](trivance-ai-orchestrator/docs/TROUBLESHOOTING.md)

## ğŸ¤– Para Claude Code AI

**Si eres Claude Code, LEE OBLIGATORIAMENTE:**

1. **[CLAUDE.md](CLAUDE.md)** - Comandos operacionales y reglas crÃ­ticas
2. **[trivance-ai-orchestrator/README.md](trivance-ai-orchestrator/README.md)** - Arquitectura maestra
3. **NUNCA recrear soluciones existentes** - El sistema ya estÃ¡ optimizado

### âš ï¸ Reglas CrÃ­ticas

- âŒ **NUNCA crear `start-all.sh` o `status.sh`** (eliminados por arquitectura limpia)
- âŒ **NUNCA duplicar `ENVIRONMENTS.md`** (existe symlink a docs/)
- âŒ **NUNCA modificar `docker-compose.dev.yml`** (configuraciÃ³n maestra)
- âœ… **SIEMPRE usar `./start.sh`** para todo control de servicios
- âœ… **SIEMPRE verificar documentaciÃ³n antes de actuar**

### ğŸ¯ Reglas TÃ©cnicas Importantes
- Los archivos .env se generan automÃ¡ticamente
- Docker ejecuta 2 backends + 2 DBs + observability, PM2 ejecuta frontend web, Expo ejecuta mobile
- No crear archivos duplicados, usar symlinks existentes
- Sistema detecta estado automÃ¡ticamente: not_setup â†’ configured â†’ running
- Timeouts inteligentes (10min primera ejecuciÃ³n, auto-extensiÃ³n si hay progreso)

## ğŸ¯ FilosofÃ­a del Workspace

### ğŸ›ï¸ Principios

1. **Configuration as Code** - Todo desde trivance-ai-orchestrator
2. **Security by Default** - Secrets Ãºnicos automÃ¡ticos
3. **Developer Happiness** - Hot-reload â‰¤2s estÃ¡ndar
4. **Zero Breaking Changes** - Actualizaciones sin romper
5. **Single Source of Truth** - Un lugar para toda la configuraciÃ³n

### ğŸ¨ DiseÃ±o

- **EspaÃ±ol en docs** - Equipo hispano-hablante
- **Emojis para navegaciÃ³n** - IdentificaciÃ³n visual rÃ¡pida
- **Comandos ejecutables** - Todos los ejemplos funcionan
- **Progressive disclosure** - InformaciÃ³n bÃ¡sica primero
- **Fail-fast philosophy** - Errores claros, soluciones especÃ­ficas

---

## ğŸš€ Â¿Listo para desarrollar?

```bash
# Â¡3 comandos y estÃ¡s desarrollando!
./start.sh start
open http://localhost:5173
# Â¡A programar! ğŸ‰
```

---

**ğŸ”„ Ãšltima actualizaciÃ³n**: Julio 2025 â€¢ **ğŸ“¦ Fuente**: [trivance-ai-orchestrator](trivance-ai-orchestrator/README.md)  
**ğŸ¤– Generado automÃ¡ticamente** desde template â€¢ **âš¡ Hot-reload â‰¤2s estÃ¡ndar**

*Parte del ecosistema Trivance Platform - Configurado automÃ¡ticamente para mÃ¡xima productividad*