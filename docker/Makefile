.PHONY: help up down logs rebuild clean status shell-management shell-auth

# Default target
help: ## Show this help message
	@echo "Trivance Docker Management"
	@echo "========================="
	@echo ""
	@echo "Available targets:"
	@grep -E '^[a-zA-Z_-]+:.*?## .*$$' $(MAKEFILE_LIST) | awk 'BEGIN {FS = ":.*?## "}; {printf "  %-15s %s\n", $$1, $$2}'

up: ## Start all services
	@echo "ğŸš€ Starting Trivance services..."
	docker-compose up -d
	@echo "âœ… Services started. Check logs with 'make logs'"

down: ## Stop all services
	@echo "ğŸ›‘ Stopping Trivance services..."
	docker-compose down
	@echo "âœ… Services stopped"

logs: ## Show logs for all services
	docker-compose logs -f

logs-management: ## Show logs for management service only
	docker-compose logs -f ms_level_up_management

logs-auth: ## Show logs for auth service only
	docker-compose logs -f ms_trivance_auth

rebuild: ## Rebuild and restart all services
	@echo "ğŸ”„ Rebuilding services..."
	docker-compose down
	docker-compose build --no-cache
	docker-compose up -d
	@echo "âœ… Services rebuilt and restarted"

clean: ## Remove all containers, images and volumes
	@echo "ğŸ§¹ Cleaning up Docker resources..."
	docker-compose down -v --rmi all
	@echo "âœ… Cleanup completed"

status: ## Show status of all services
	docker-compose ps

shell-management: ## Open shell in management service
	docker-compose exec ms_level_up_management sh

shell-auth: ## Open shell in auth service
	docker-compose exec ms_trivance_auth sh

# Database management
db-reset: ## Reset all databases (WARNING: destroys data)
	@echo "ğŸ—‘ï¸  Resetting databases..."
	docker-compose down -v
	docker-compose up -d postgres mongodb
	@echo "âœ… Databases reset and ready"

db-logs: ## Show database logs
	docker-compose logs -f postgres mongodb
